{"Headers":{"Last-Modified":"Sat, 03 Apr 2021 10:00:34 GMT","X-Content-Type-Options":"nosniff"},"Body":"LyohLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAqIHhab29tIHYxLjAuMTQNCiAqIChjKSAyMDEzIGJ5IEF6YXQgQWhtZWRvdiAmIEVsbWFuIEd1c2V5bm92DQogKiBodHRwczovL2dpdGh1Yi5jb20vcGF5YWxvcmQNCiAqIGh0dHBzOi8vZHJpYmJibGUuY29tL2VsbWFudmVicw0KICogQXBhY2hlIExpY2Vuc2UgMi4wDQogKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQo7DQp3aW5kb3cucmVxdWVzdEFuaW1GcmFtZSA9IChmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBmdW5jdGlvbiAoYSkgew0KICAgICAgICB3aW5kb3cuc2V0VGltZW91dChhLCAyMCkNCiAgICB9DQp9KSgpOw0KDQpmdW5jdGlvbiBkZXRlY3Rfb2xkX2llKCkgew0KICAgIGlmICgvTVNJRSAoXGQrXC5cZCspOy8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgew0KICAgICAgICB2YXIgYSA9IG5ldyBOdW1iZXIoUmVnRXhwLiQxKTsNCiAgICAgICAgaWYgKGEgPj0gOSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAoYSA+PSA4KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKGEgPj0gNykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhID49IDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYSA+PSA1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0NCn0gKGZ1bmN0aW9uIChiKSB7DQogICAgYi5mbi54b24gPSBiLmZuLm9uIHx8IGIuZm4uYmluZDsNCiAgICBiLmZuLnhvZmYgPSBiLmZuLm9mZiB8fCBiLmZuLmJpbmQ7DQoNCiAgICBmdW5jdGlvbiBhKGF4LCBhRykgew0KICAgICAgICB0aGlzLnh6b29tID0gdHJ1ZTsNCiAgICAgICAgdmFyIEUgPSB0aGlzOw0KICAgICAgICB2YXIgTTsNCiAgICAgICAgdmFyIGFEID0ge307DQogICAgICAgIHZhciBhZCwgYWssIGFhLCBhaiwgYWMsIGFpLCBhbSwgUiwgYUYsIHgsIGFvLCBaLCBYOw0KICAgICAgICB2YXIgYXksIG8sIFAsIFQsIFMsIGFiLCBwID0gbmV3IEFycmF5KCk7DQogICAgICAgIHZhciBGID0gbmV3IEFycmF5KCksDQogICAgICAgICAgICBhQyA9IDAsDQogICAgICAgICAgICB5ID0gMDsNCiAgICAgICAgdmFyIEksIFEsIGwsIGs7DQogICAgICAgIHZhciBhcSwgYUIsIGF3LCBhdSwgTywgbiwgYUwsIGFKLCBhQSwgYXosIFcsIFUsIGFwLCBhbCA9IDA7DQogICAgICAgIHZhciBoLCBhaDsNCiAgICAgICAgdmFyIGFLLCBCID0gMCwNCiAgICAgICAgICAgIHogPSAwLA0KICAgICAgICAgICAgYWcgPSAwLA0KICAgICAgICAgICAgYWUgPSAwLA0KICAgICAgICAgICAgcyA9IDAsDQogICAgICAgICAgICByID0gMCwNCiAgICAgICAgICAgIGF0ID0gMCwNCiAgICAgICAgICAgIGFyID0gMCwNCiAgICAgICAgICAgIEggPSAwLA0KICAgICAgICAgICAgRyA9IDA7DQogICAgICAgIHZhciBEID0gZGV0ZWN0X29sZF9pZSgpLA0KICAgICAgICAgICAgQSA9IC9NU0lFIChcZCtcLlxkKyk7Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLA0KICAgICAgICAgICAgWSwgVjsNCiAgICAgICAgdmFyIEssIGogPSAiIiwNCiAgICAgICAgICAgIEosIHQ7DQogICAgICAgIHZhciBhSSwgZiwgbSwgcSwgZywgaSwgYW4sIGQ7DQogICAgICAgIHRoaXMuYWRhcHRpdmUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAobSA9PSAwIHx8IHEgPT0gMCkgew0KICAgICAgICAgICAgICAgIGF4LmNzcygid2lkdGgiLCAiIik7DQogICAgICAgICAgICAgICAgYXguY3NzKCJoZWlnaHQiLCAiIik7DQogICAgICAgICAgICAgICAgbSA9IGF4LndpZHRoKCk7DQogICAgICAgICAgICAgICAgcSA9IGF4LmhlaWdodCgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhSCgpOw0KICAgICAgICAgICAgYUkgPSBiKHdpbmRvdykud2lkdGgoKTsNCiAgICAgICAgICAgIGYgPSBiKHdpbmRvdykuaGVpZ2h0KCk7DQogICAgICAgICAgICBnID0gYXgud2lkdGgoKTsNCiAgICAgICAgICAgIGkgPSBheC5oZWlnaHQoKTsNCiAgICAgICAgICAgIHZhciB1ID0gZmFsc2U7DQogICAgICAgICAgICBpZiAobSA+IGFJIHx8IHEgPiBmKSB7DQogICAgICAgICAgICAgICAgdSA9IHRydWUNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChnID4gbSkgew0KICAgICAgICAgICAgICAgIGcgPSBtDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoaSA+IHEpIHsNCiAgICAgICAgICAgICAgICBpID0gcQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHUpIHsNCiAgICAgICAgICAgICAgICBheC53aWR0aCgiMTAwJSIpDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChtICE9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYXgud2lkdGgobSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYW4gIT0gImZ1bGxzY3JlZW4iKSB7DQogICAgICAgICAgICAgICAgaWYgKGFFKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgRS5vcHRpb25zLnBvc2l0aW9uID0gYW4NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBFLm9wdGlvbnMucG9zaXRpb24gPSBFLm9wdGlvbnMubXBvc2l0aW9uDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFFLm9wdGlvbnMubGVuc1JldmVyc2UpIHsNCiAgICAgICAgICAgICAgICBkID0gRS5vcHRpb25zLmFkYXB0aXZlUmV2ZXJzZSAmJiBFLm9wdGlvbnMucG9zaXRpb24gPT0gRS5vcHRpb25zLm1wb3NpdGlvbg0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIGZ1bmN0aW9uIGF2KCkgew0KICAgICAgICAgICAgdmFyIGFNID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICAgICAgdmFyIHYgPSAod2luZG93LnBhZ2VYT2Zmc2V0IHx8IGFNLnNjcm9sbExlZnQpIC0gKGFNLmNsaWVudExlZnQgfHwgMCk7DQogICAgICAgICAgICB2YXIgdSA9ICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgYU0uc2Nyb2xsVG9wKSAtIChhTS5jbGllbnRUb3AgfHwgMCk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGxlZnQ6IHYsDQogICAgICAgICAgICAgICAgdG9wOiB1DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBhRSgpIHsNCiAgICAgICAgICAgIHZhciB1ID0gYXgub2Zmc2V0KCk7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnpvb21XaWR0aCA9PSAiYXV0byIpIHsNCiAgICAgICAgICAgICAgICBhYSA9IGcNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYWEgPSBFLm9wdGlvbnMuem9vbVdpZHRoDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnpvb21IZWlnaHQgPT0gImF1dG8iKSB7DQogICAgICAgICAgICAgICAgYWogPSBpDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFqID0gRS5vcHRpb25zLnpvb21IZWlnaHQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChFLm9wdGlvbnMucG9zaXRpb24uc3Vic3RyKDAsIDEpID09ICIjIikgew0KICAgICAgICAgICAgICAgIGFEID0gYihFLm9wdGlvbnMucG9zaXRpb24pDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFELmxlbmd0aCA9IDANCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhRC5sZW5ndGggIT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgICBzd2l0Y2ggKGFuKSB7DQogICAgICAgICAgICAgICAgY2FzZSAibGVucyI6DQogICAgICAgICAgICAgICAgY2FzZSAiaW5zaWRlIjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInRvcCI6DQogICAgICAgICAgICAgICAgICAgIGFpID0gdS50b3A7DQogICAgICAgICAgICAgICAgICAgIGFtID0gdS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBSID0gYWkgLSBhajsNCiAgICAgICAgICAgICAgICAgICAgYUYgPSBhbTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAibGVmdCI6DQogICAgICAgICAgICAgICAgICAgIGFpID0gdS50b3A7DQogICAgICAgICAgICAgICAgICAgIGFtID0gdS5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBSID0gYWk7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW0gLSBhYTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAiYm90dG9tIjoNCiAgICAgICAgICAgICAgICAgICAgYWkgPSB1LnRvcDsNCiAgICAgICAgICAgICAgICAgICAgYW0gPSB1LmxlZnQ7DQogICAgICAgICAgICAgICAgICAgIFIgPSBhaSArIGk7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW07DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInJpZ2h0IjoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBhaSA9IHUudG9wOw0KICAgICAgICAgICAgICAgICAgICBhbSA9IHUubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgUiA9IGFpOw0KICAgICAgICAgICAgICAgICAgICBhRiA9IGFtICsgZw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFGICsgYWEgPiBhSSB8fCBhRiA8IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgIH0NCiAgICAgICAgdGhpcy54c2Nyb2xsID0gZnVuY3Rpb24gKHYpIHsNCiAgICAgICAgICAgIFogPSB2LnBhZ2VYIHx8IHYub3JpZ2luYWxFdmVudC5wYWdlWDsNCiAgICAgICAgICAgIFggPSB2LnBhZ2VZIHx8IHYub3JpZ2luYWxFdmVudC5wYWdlWTsNCiAgICAgICAgICAgIHYucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGlmICh2LnhzY2FsZSkgew0KICAgICAgICAgICAgICAgIGFsID0gdi54c2NhbGU7DQogICAgICAgICAgICAgICAgTChaLCBYKQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgYU4gPSAtdi5vcmlnaW5hbEV2ZW50LmRldGFpbCB8fCB2Lm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSB8fCB2LnhkZWx0YTsNCiAgICAgICAgICAgICAgICB2YXIgdSA9IFo7DQogICAgICAgICAgICAgICAgdmFyIGFNID0gWDsNCiAgICAgICAgICAgICAgICBpZiAoRCkgew0KICAgICAgICAgICAgICAgICAgICB1ID0gWTsNCiAgICAgICAgICAgICAgICAgICAgYU0gPSBWDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChhTiA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYU4gPSAtMC4wNQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFOID0gMC4wNQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBhbCArPSBhTjsNCiAgICAgICAgICAgICAgICBMKHUsIGFNKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIGZ1bmN0aW9uIHcoKSB7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLmxlbnNTaGFwZSA9PSAiY2lyY2xlIiAmJiBFLm9wdGlvbnMucG9zaXRpb24gPT0gImxlbnMiKSB7DQogICAgICAgICAgICAgICAgYXEgPSBhQiA9IE1hdGgubWF4KGFxLCBhQik7DQogICAgICAgICAgICAgICAgdmFyIHUgPSAoYXEgKyBNYXRoLm1heChuLCBPKSAqIDIpIC8gMjsNCiAgICAgICAgICAgICAgICBsLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICItbW96LWJvcmRlci1yYWRpdXMiOiB1LA0KICAgICAgICAgICAgICAgICAgICAiLXdlYmtpdC1ib3JkZXItcmFkaXVzIjogdSwNCiAgICAgICAgICAgICAgICAgICAgImJvcmRlci1yYWRpdXMiOiB1DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIEModSwgYU4sIGFNLCB2KSB7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uID09ICJsZW5zIikgew0KICAgICAgICAgICAgICAgIFEuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgdG9wOiAtKGFOIC0gYWkpICogYXogKyAoYUIgLyAyKSwNCiAgICAgICAgICAgICAgICAgICAgbGVmdDogLSh1IC0gYW0pICogYUEgKyAoYXEgLyAyKQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGlmIChFLm9wdGlvbnMuYmcpIHsNCiAgICAgICAgICAgICAgICAgICAgbC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tncm91bmQtaW1hZ2UiOiAidXJsKCIgKyBRLmF0dHIoInNyYyIpICsgIikiLA0KICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tncm91bmQtcmVwZWF0IjogIm5vLXJlcGVhdCIsDQogICAgICAgICAgICAgICAgICAgICAgICAiYmFja2dyb3VuZC1wb3NpdGlvbiI6ICgtKHUgLSBhbSkgKiBhQSArIChhcSAvIDIpKSArICJweCAiICsgKC0oYU4gLSBhaSkgKiBheiArIChhQiAvIDIpKSArICJweCINCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChhTSAmJiB2KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tncm91bmQtc2l6ZSI6IGFNICsgInB4ICIgKyB2ICsgInB4Ig0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgUS5jc3Moew0KICAgICAgICAgICAgICAgICAgICB0b3A6IC1hdSAqIGF6LA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiAtYXcgKiBhQQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBMKHUsIGFPKSB7DQogICAgICAgICAgICBpZiAoYWwgPCAtMSkgew0KICAgICAgICAgICAgICAgIGFsID0gLTENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChhbCA+IDEpIHsNCiAgICAgICAgICAgICAgICBhbCA9IDENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBhTiwgdiwgYU07DQogICAgICAgICAgICBpZiAoVyA8IFUpIHsNCiAgICAgICAgICAgICAgICBhTiA9IFcgLSAoVyAtIDEpICogYWw7DQogICAgICAgICAgICAgICAgdiA9IGFhICogYU47DQogICAgICAgICAgICAgICAgYU0gPSB2IC8gYXANCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYU4gPSBVIC0gKFUgLSAxKSAqIGFsOw0KICAgICAgICAgICAgICAgIGFNID0gYWogKiBhTjsNCiAgICAgICAgICAgICAgICB2ID0gYU0gKiBhcA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFLKSB7DQogICAgICAgICAgICAgICAgQiA9IHU7DQogICAgICAgICAgICAgICAgeiA9IGFPOw0KICAgICAgICAgICAgICAgIGFnID0gdjsNCiAgICAgICAgICAgICAgICBhZSA9IGFNDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICghYUspIHsNCiAgICAgICAgICAgICAgICAgICAgcyA9IGFnID0gdjsNCiAgICAgICAgICAgICAgICAgICAgciA9IGFlID0gYU0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYUEgPSB2IC8gYWQ7DQogICAgICAgICAgICAgICAgYXogPSBhTSAvIGFrOw0KICAgICAgICAgICAgICAgIGFxID0gYWEgLyBhQTsNCiAgICAgICAgICAgICAgICBhQiA9IGFqIC8gYXo7DQogICAgICAgICAgICAgICAgdygpOw0KICAgICAgICAgICAgICAgIGUodSwgYU8pOw0KICAgICAgICAgICAgICAgIFEud2lkdGgodik7DQogICAgICAgICAgICAgICAgUS5oZWlnaHQoYU0pOw0KICAgICAgICAgICAgICAgIGwud2lkdGgoYXEpOw0KICAgICAgICAgICAgICAgIGwuaGVpZ2h0KGFCKTsNCiAgICAgICAgICAgICAgICBsLmNzcyh7DQogICAgICAgICAgICAgICAgICAgIHRvcDogYXUgLSBuLA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiBhdyAtIE8NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBrLmNzcyh7DQogICAgICAgICAgICAgICAgICAgIHRvcDogLWF1LA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiAtYXcNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBDKHUsIGFPLCB2LCBhTSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGMoKSB7DQogICAgICAgICAgICB2YXIgdSA9IGF0Ow0KICAgICAgICAgICAgdmFyIGFQID0gYXI7DQogICAgICAgICAgICB2YXIgdiA9IEg7DQogICAgICAgICAgICB2YXIgYU0gPSBHOw0KICAgICAgICAgICAgdmFyIGFPID0gczsNCiAgICAgICAgICAgIHZhciBhTiA9IHI7DQogICAgICAgICAgICB1ICs9IChCIC0gdSkgLyBFLm9wdGlvbnMuc21vb3RoTGVuc01vdmU7DQogICAgICAgICAgICBhUCArPSAoeiAtIGFQKSAvIEUub3B0aW9ucy5zbW9vdGhMZW5zTW92ZTsNCiAgICAgICAgICAgIHYgKz0gKEIgLSB2KSAvIEUub3B0aW9ucy5zbW9vdGhab29tTW92ZTsNCiAgICAgICAgICAgIGFNICs9ICh6IC0gYU0pIC8gRS5vcHRpb25zLnNtb290aFpvb21Nb3ZlOw0KICAgICAgICAgICAgYU8gKz0gKGFnIC0gYU8pIC8gRS5vcHRpb25zLnNtb290aFNjYWxlOw0KICAgICAgICAgICAgYU4gKz0gKGFlIC0gYU4pIC8gRS5vcHRpb25zLnNtb290aFNjYWxlOw0KICAgICAgICAgICAgYUEgPSBhTyAvIGFkOw0KICAgICAgICAgICAgYXogPSBhTiAvIGFrOw0KICAgICAgICAgICAgYXEgPSBhYSAvIGFBOw0KICAgICAgICAgICAgYUIgPSBhaiAvIGF6Ow0KICAgICAgICAgICAgdygpOw0KICAgICAgICAgICAgZSh1LCBhUCk7DQogICAgICAgICAgICBRLndpZHRoKGFPKTsNCiAgICAgICAgICAgIFEuaGVpZ2h0KGFOKTsNCiAgICAgICAgICAgIGwud2lkdGgoYXEpOw0KICAgICAgICAgICAgbC5oZWlnaHQoYUIpOw0KICAgICAgICAgICAgbC5jc3Moew0KICAgICAgICAgICAgICAgIHRvcDogYXUgLSBuLA0KICAgICAgICAgICAgICAgIGxlZnQ6IGF3IC0gTw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBrLmNzcyh7DQogICAgICAgICAgICAgICAgdG9wOiAtYXUsDQogICAgICAgICAgICAgICAgbGVmdDogLWF3DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGUodiwgYU0pOw0KICAgICAgICAgICAgQyh1LCBhUCwgYU8sIGFOKTsNCiAgICAgICAgICAgIGF0ID0gdTsNCiAgICAgICAgICAgIGFyID0gYVA7DQogICAgICAgICAgICBIID0gdjsNCiAgICAgICAgICAgIEcgPSBhTTsNCiAgICAgICAgICAgIHMgPSBhTzsNCiAgICAgICAgICAgIHIgPSBhTjsNCiAgICAgICAgICAgIGlmIChhSykgew0KICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUoYykNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGUodSwgdikgew0KICAgICAgICAgICAgdSAtPSBhbTsNCiAgICAgICAgICAgIHYgLT0gYWk7DQogICAgICAgICAgICBhdyA9IHUgLSAoYXEgLyAyKTsNCiAgICAgICAgICAgIGF1ID0gdiAtIChhQiAvIDIpOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5wb3NpdGlvbiAhPSAibGVucyIgJiYgRS5vcHRpb25zLmxlbnNDb2xsaXNpb24pIHsNCiAgICAgICAgICAgICAgICBpZiAoYXcgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIGF3ID0gMA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWQgPj0gYXEgJiYgYXcgPiBhZCAtIGFxKSB7DQogICAgICAgICAgICAgICAgICAgIGF3ID0gYWQgLSBhcQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWQgPCBhcSkgew0KICAgICAgICAgICAgICAgICAgICBhdyA9IGFkIC8gMiAtIGFxIC8gMg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYXUgPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIGF1ID0gMA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWsgPj0gYUIgJiYgYXUgPiBhayAtIGFCKSB7DQogICAgICAgICAgICAgICAgICAgIGF1ID0gYWsgLSBhQg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYWsgPCBhQikgew0KICAgICAgICAgICAgICAgICAgICBhdSA9IGFrIC8gMiAtIGFCIC8gMg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGFIKCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBheSAhPSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgIGF5LnJlbW92ZSgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIFAgIT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICBQLnJlbW92ZSgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIHQgIT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICB0LnJlbW92ZSgpDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBOKHUsIGFNKSB7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uID09ICJmdWxsc2NyZWVuIikgew0KICAgICAgICAgICAgICAgIGFkID0gYih3aW5kb3cpLndpZHRoKCk7DQogICAgICAgICAgICAgICAgYWsgPSBiKHdpbmRvdykuaGVpZ2h0KCkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYWQgPSBheC53aWR0aCgpOw0KICAgICAgICAgICAgICAgIGFrID0gYXguaGVpZ2h0KCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFQuY3NzKHsNCiAgICAgICAgICAgICAgICB0b3A6IGFrIC8gMiAtIFQuaGVpZ2h0KCkgLyAyLA0KICAgICAgICAgICAgICAgIGxlZnQ6IGFkIC8gMiAtIFQud2lkdGgoKSAvIDINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5yb290T3V0cHV0IHx8IEUub3B0aW9ucy5wb3NpdGlvbiA9PSAiZnVsbHNjcmVlbiIpIHsNCiAgICAgICAgICAgICAgICBhYyA9IGF4Lm9mZnNldCgpDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGFjID0gYXgucG9zaXRpb24oKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYWMudG9wID0gTWF0aC5yb3VuZChhYy50b3ApOw0KICAgICAgICAgICAgYWMubGVmdCA9IE1hdGgucm91bmQoYWMubGVmdCk7DQogICAgICAgICAgICBzd2l0Y2ggKEUub3B0aW9ucy5wb3NpdGlvbikgew0KICAgICAgICAgICAgICAgIGNhc2UgImZ1bGxzY3JlZW4iOg0KICAgICAgICAgICAgICAgICAgICBhaSA9IGF2KCkudG9wOw0KICAgICAgICAgICAgICAgICAgICBhbSA9IGF2KCkubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgUiA9IDA7DQogICAgICAgICAgICAgICAgICAgIGFGID0gMDsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAiaW5zaWRlIjoNCiAgICAgICAgICAgICAgICAgICAgYWkgPSBhYy50b3A7DQogICAgICAgICAgICAgICAgICAgIGFtID0gYWMubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgUiA9IDA7DQogICAgICAgICAgICAgICAgICAgIGFGID0gMDsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAidG9wIjoNCiAgICAgICAgICAgICAgICAgICAgYWkgPSBhYy50b3A7DQogICAgICAgICAgICAgICAgICAgIGFtID0gYWMubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgUiA9IGFpIC0gYWo7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW07DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgImxlZnQiOg0KICAgICAgICAgICAgICAgICAgICBhaSA9IGFjLnRvcDsNCiAgICAgICAgICAgICAgICAgICAgYW0gPSBhYy5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBSID0gYWk7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW0gLSBhYTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAiYm90dG9tIjoNCiAgICAgICAgICAgICAgICAgICAgYWkgPSBhYy50b3A7DQogICAgICAgICAgICAgICAgICAgIGFtID0gYWMubGVmdDsNCiAgICAgICAgICAgICAgICAgICAgUiA9IGFpICsgYWs7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW07DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInJpZ2h0IjoNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgICBhaSA9IGFjLnRvcDsNCiAgICAgICAgICAgICAgICAgICAgYW0gPSBhYy5sZWZ0Ow0KICAgICAgICAgICAgICAgICAgICBSID0gYWk7DQogICAgICAgICAgICAgICAgICAgIGFGID0gYW0gKyBhZA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYWkgLT0gYXkub3V0ZXJIZWlnaHQoKSAvIDI7DQogICAgICAgICAgICBhbSAtPSBheS5vdXRlcldpZHRoKCkgLyAyOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5wb3NpdGlvbi5zdWJzdHIoMCwgMSkgPT0gIiMiKSB7DQogICAgICAgICAgICAgICAgYUQgPSBiKEUub3B0aW9ucy5wb3NpdGlvbikNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYUQubGVuZ3RoID0gMA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFELmxlbmd0aCA9PSAwICYmIEUub3B0aW9ucy5wb3NpdGlvbiAhPSAiaW5zaWRlIiAmJiBFLm9wdGlvbnMucG9zaXRpb24gIT0gImZ1bGxzY3JlZW4iKSB7DQogICAgICAgICAgICAgICAgaWYgKCFFLm9wdGlvbnMuYWRhcHRpdmUgfHwgIW0gfHwgIXEpIHsNCiAgICAgICAgICAgICAgICAgICAgbSA9IGFkOw0KICAgICAgICAgICAgICAgICAgICBxID0gYWsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy56b29tV2lkdGggPT0gImF1dG8iKSB7DQogICAgICAgICAgICAgICAgICAgIGFhID0gYWQNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBhYSA9IEUub3B0aW9ucy56b29tV2lkdGgNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy56b29tSGVpZ2h0ID09ICJhdXRvIikgew0KICAgICAgICAgICAgICAgICAgICBhaiA9IGFrDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYWogPSBFLm9wdGlvbnMuem9vbUhlaWdodA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBSICs9IEUub3B0aW9ucy5Zb2Zmc2V0Ow0KICAgICAgICAgICAgICAgIGFGICs9IEUub3B0aW9ucy5Yb2Zmc2V0Ow0KICAgICAgICAgICAgICAgIFAuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGFhICsgInB4IiwNCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhaiArICJweCIsDQogICAgICAgICAgICAgICAgICAgIHRvcDogUiwNCiAgICAgICAgICAgICAgICAgICAgbGVmdDogYUYNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uICE9ICJsZW5zIikgew0KICAgICAgICAgICAgICAgICAgICBNLmFwcGVuZChQKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5wb3NpdGlvbiA9PSAiaW5zaWRlIiB8fCBFLm9wdGlvbnMucG9zaXRpb24gPT0gImZ1bGxzY3JlZW4iKSB7DQogICAgICAgICAgICAgICAgICAgIGFhID0gYWQ7DQogICAgICAgICAgICAgICAgICAgIGFqID0gYWs7DQogICAgICAgICAgICAgICAgICAgIFAuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBhYSArICJweCIsDQogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGFqICsgInB4Ig0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgYXkuYXBwZW5kKFApDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYWEgPSBhRC53aWR0aCgpOw0KICAgICAgICAgICAgICAgICAgICBhaiA9IGFELmhlaWdodCgpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnJvb3RPdXRwdXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFIgPSBhRC5vZmZzZXQoKS50b3A7DQogICAgICAgICAgICAgICAgICAgICAgICBhRiA9IGFELm9mZnNldCgpLmxlZnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBNLmFwcGVuZChQKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgUiA9IGFELnBvc2l0aW9uKCkudG9wOw0KICAgICAgICAgICAgICAgICAgICAgICAgYUYgPSBhRC5wb3NpdGlvbigpLmxlZnQ7DQogICAgICAgICAgICAgICAgICAgICAgICBhRC5wYXJlbnQoKS5hcHBlbmQoUCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBSICs9IChhRC5vdXRlckhlaWdodCgpIC0gYWogLSBQLm91dGVySGVpZ2h0KCkpIC8gMjsNCiAgICAgICAgICAgICAgICAgICAgYUYgKz0gKGFELm91dGVyV2lkdGgoKSAtIGFhIC0gUC5vdXRlcldpZHRoKCkpIC8gMjsNCiAgICAgICAgICAgICAgICAgICAgUC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGFhICsgInB4IiwNCiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogYWogKyAicHgiLA0KICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBSLA0KICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYUYNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnRpdGxlICYmIGogIT0gIiIpIHsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uID09ICJpbnNpZGUiIHx8IEUub3B0aW9ucy5wb3NpdGlvbiA9PSAibGVucyIgfHwgRS5vcHRpb25zLnBvc2l0aW9uID09ICJmdWxsc2NyZWVuIikgew0KICAgICAgICAgICAgICAgICAgICB4ID0gUjsNCiAgICAgICAgICAgICAgICAgICAgYW8gPSBhRjsNCiAgICAgICAgICAgICAgICAgICAgYXkuYXBwZW5kKHQpDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgeCA9IFIgKyAoUC5vdXRlckhlaWdodCgpIC0gYWopIC8gMjsNCiAgICAgICAgICAgICAgICAgICAgYW8gPSBhRiArIChQLm91dGVyV2lkdGgoKSAtIGFhKSAvIDI7DQogICAgICAgICAgICAgICAgICAgIE0uYXBwZW5kKHQpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHQuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGFhICsgInB4IiwNCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhaiArICJweCIsDQogICAgICAgICAgICAgICAgICAgIHRvcDogeCwNCiAgICAgICAgICAgICAgICAgICAgbGVmdDogYW8NCiAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXkuY3NzKHsNCiAgICAgICAgICAgICAgICB3aWR0aDogYWQgKyAicHgiLA0KICAgICAgICAgICAgICAgIGhlaWdodDogYWsgKyAicHgiLA0KICAgICAgICAgICAgICAgIHRvcDogYWksDQogICAgICAgICAgICAgICAgbGVmdDogYW0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgby5jc3Moew0KICAgICAgICAgICAgICAgIHdpZHRoOiBhZCArICJweCIsDQogICAgICAgICAgICAgICAgaGVpZ2h0OiBhayArICJweCINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy50aW50ICYmIChFLm9wdGlvbnMucG9zaXRpb24gIT0gImluc2lkZSIgJiYgRS5vcHRpb25zLnBvc2l0aW9uICE9ICJmdWxsc2NyZWVuIikpIHsNCiAgICAgICAgICAgICAgICBvLmNzcygiYmFja2dyb3VuZC1jb2xvciIsIEUub3B0aW9ucy50aW50KQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoRCkgew0KICAgICAgICAgICAgICAgICAgICBvLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICAiYmFja2dyb3VuZC1pbWFnZSI6ICJ1cmwoIiArIGF4LmF0dHIoInNyYyIpICsgIikiLA0KICAgICAgICAgICAgICAgICAgICAgICAgImJhY2tncm91bmQtY29sb3IiOiAiI2ZmZiINCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBJID0gbmV3IEltYWdlKCk7DQogICAgICAgICAgICB2YXIgdiA9ICIiOw0KICAgICAgICAgICAgaWYgKEEpIHsNCiAgICAgICAgICAgICAgICB2ID0gIj9yPSIgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBJLnNyYyA9IGF4LmF0dHIoInhvcmlnaW5hbCIpICsgdjsNCiAgICAgICAgICAgIFEgPSBiKEkpOw0KICAgICAgICAgICAgUS5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7DQogICAgICAgICAgICBJID0gbmV3IEltYWdlKCk7DQogICAgICAgICAgICBJLnNyYyA9IGF4LmF0dHIoInNyYyIpOw0KICAgICAgICAgICAgayA9IGIoSSk7DQogICAgICAgICAgICBrLmNzcygicG9zaXRpb24iLCAiYWJzb2x1dGUiKTsNCiAgICAgICAgICAgIGsud2lkdGgoYWQpOw0KICAgICAgICAgICAgc3dpdGNoIChFLm9wdGlvbnMucG9zaXRpb24pIHsNCiAgICAgICAgICAgICAgICBjYXNlICJmdWxsc2NyZWVuIjoNCiAgICAgICAgICAgICAgICBjYXNlICJpbnNpZGUiOg0KICAgICAgICAgICAgICAgICAgICBQLmFwcGVuZChRKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAibGVucyI6DQogICAgICAgICAgICAgICAgICAgIGwuYXBwZW5kKFEpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmJnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBRLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiDQogICAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIFAuYXBwZW5kKFEpOw0KICAgICAgICAgICAgICAgICAgICBsLmFwcGVuZChrKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMub3Blbnpvb20gPSBmdW5jdGlvbiAodSkgew0KICAgICAgICAgICAgWiA9IHUucGFnZVg7DQogICAgICAgICAgICBYID0gdS5wYWdlWTsNCiAgICAgICAgICAgIGlmIChFLm9wdGlvbnMuYWRhcHRpdmUpIHsNCiAgICAgICAgICAgICAgICBFLmFkYXB0aXZlKCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGFsID0gRS5vcHRpb25zLmRlZmF1bHRTY2FsZTsNCiAgICAgICAgICAgIGFLID0gZmFsc2U7DQogICAgICAgICAgICBheSA9IGIoIjxkaXY+PC9kaXY+Iik7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnNvdXJjZUNsYXNzICE9ICIiKSB7DQogICAgICAgICAgICAgICAgYXkuYWRkQ2xhc3MoRS5vcHRpb25zLnNvdXJjZUNsYXNzKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYXkuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpOw0KICAgICAgICAgICAgVCA9IGIoIjxkaXY+PC9kaXY+Iik7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLmxvYWRpbmdDbGFzcyAhPSAiIikgew0KICAgICAgICAgICAgICAgIFQuYWRkQ2xhc3MoRS5vcHRpb25zLmxvYWRpbmdDbGFzcykNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFQuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpOw0KICAgICAgICAgICAgbyA9IGIoJzxkaXYgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyI+PC9kaXY+Jyk7DQogICAgICAgICAgICBheS5hcHBlbmQoVCk7DQogICAgICAgICAgICBQID0gYigiPGRpdj48L2Rpdj4iKTsNCiAgICAgICAgICAgIGlmIChFLm9wdGlvbnMuem9vbUNsYXNzICE9ICIiICYmIEUub3B0aW9ucy5wb3NpdGlvbiAhPSAiZnVsbHNjcmVlbiIpIHsNCiAgICAgICAgICAgICAgICBQLmFkZENsYXNzKEUub3B0aW9ucy56b29tQ2xhc3MpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBQLmNzcyh7DQogICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsDQogICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICJoaWRkZW4iLA0KICAgICAgICAgICAgICAgIG9wYWNpdHk6IDENCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy50aXRsZSAmJiBqICE9ICIiKSB7DQogICAgICAgICAgICAgICAgdCA9IGIoIjxkaXY+PC9kaXY+Iik7DQogICAgICAgICAgICAgICAgSiA9IGIoIjxkaXY+PC9kaXY+Iik7DQogICAgICAgICAgICAgICAgdC5jc3Moew0KICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwNCiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGlmIChFLm9wdGlvbnMudGl0bGVDbGFzcykgew0KICAgICAgICAgICAgICAgICAgICBKLmFkZENsYXNzKEUub3B0aW9ucy50aXRsZUNsYXNzKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBKLmh0bWwoIjxzcGFuPiIgKyBqICsgIjwvc3Bhbj4iKTsNCiAgICAgICAgICAgICAgICB0LmFwcGVuZChKKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmZhZGVJbikgew0KICAgICAgICAgICAgICAgICAgICB0LmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbCA9IGIoIjxkaXY+PC9kaXY+Iik7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLmxlbnNDbGFzcyAhPSAiIikgew0KICAgICAgICAgICAgICAgIGwuYWRkQ2xhc3MoRS5vcHRpb25zLmxlbnNDbGFzcykNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGwuY3NzKHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwNCiAgICAgICAgICAgICAgICBvdmVyZmxvdzogImhpZGRlbiINCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5sZW5zKSB7DQogICAgICAgICAgICAgICAgbGVuc3RpbnQgPSBiKCI8ZGl2PjwvZGl2PiIpOw0KICAgICAgICAgICAgICAgIGxlbnN0aW50LmNzcyh7DQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLA0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBFLm9wdGlvbnMubGVucywNCiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogRS5vcHRpb25zLmxlbnNPcGFjaXR5LA0KICAgICAgICAgICAgICAgICAgICB3aWR0aDogIjEwMCUiLA0KICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwNCiAgICAgICAgICAgICAgICAgICAgdG9wOiAwLA0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwLA0KICAgICAgICAgICAgICAgICAgICAiei1pbmRleCI6IDk5OTkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsLmFwcGVuZChsZW5zdGludCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIE4oWiwgWCk7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uICE9ICJpbnNpZGUiICYmIEUub3B0aW9ucy5wb3NpdGlvbiAhPSAiZnVsbHNjcmVlbiIpIHsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnRpbnQgfHwgRCkgew0KICAgICAgICAgICAgICAgICAgICBheS5hcHBlbmQobykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5mYWRlSW4pIHsNCiAgICAgICAgICAgICAgICAgICAgby5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgbC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMA0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgUC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMA0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBNLmFwcGVuZChheSkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5mYWRlSW4pIHsNCiAgICAgICAgICAgICAgICAgICAgUC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMA0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBNLmFwcGVuZChheSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEUuZXZlbnRtb3ZlKGF5KTsNCiAgICAgICAgICAgIEUuZXZlbnRsZWF2ZShheSk7DQogICAgICAgICAgICBzd2l0Y2ggKEUub3B0aW9ucy5wb3NpdGlvbikgew0KICAgICAgICAgICAgICAgIGNhc2UgImluc2lkZSI6DQogICAgICAgICAgICAgICAgICAgIFIgLT0gKFAub3V0ZXJIZWlnaHQoKSAtIFAuaGVpZ2h0KCkpIC8gMjsNCiAgICAgICAgICAgICAgICAgICAgYUYgLT0gKFAub3V0ZXJXaWR0aCgpIC0gUC53aWR0aCgpKSAvIDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgInRvcCI6DQogICAgICAgICAgICAgICAgICAgIFIgLT0gUC5vdXRlckhlaWdodCgpIC0gUC5oZWlnaHQoKTsNCiAgICAgICAgICAgICAgICAgICAgYUYgLT0gKFAub3V0ZXJXaWR0aCgpIC0gUC53aWR0aCgpKSAvIDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgImxlZnQiOg0KICAgICAgICAgICAgICAgICAgICBSIC09IChQLm91dGVySGVpZ2h0KCkgLSBQLmhlaWdodCgpKSAvIDI7DQogICAgICAgICAgICAgICAgICAgIGFGIC09IFAub3V0ZXJXaWR0aCgpIC0gUC53aWR0aCgpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJib3R0b20iOg0KICAgICAgICAgICAgICAgICAgICBhRiAtPSAoUC5vdXRlcldpZHRoKCkgLSBQLndpZHRoKCkpIC8gMjsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAicmlnaHQiOg0KICAgICAgICAgICAgICAgICAgICBSIC09IChQLm91dGVySGVpZ2h0KCkgLSBQLmhlaWdodCgpKSAvIDINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIFAuY3NzKHsNCiAgICAgICAgICAgICAgICB0b3A6IFIsDQogICAgICAgICAgICAgICAgbGVmdDogYUYNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgUS54b24oImxvYWQiLCBmdW5jdGlvbiAoYU4pIHsNCiAgICAgICAgICAgICAgICBULnJlbW92ZSgpOw0KICAgICAgICAgICAgICAgIGlmICghRS5vcHRpb25zLm9wZW5PblNtYWxsICYmIChRLndpZHRoKCkgPCBhYSB8fCBRLmhlaWdodCgpIDwgYWopKSB7DQogICAgICAgICAgICAgICAgICAgIEUuY2xvc2V6b29tKCk7DQogICAgICAgICAgICAgICAgICAgIGFOLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnNjcm9sbCkgew0KICAgICAgICAgICAgICAgICAgICBFLmV2ZW50c2Nyb2xsKGF5KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnBvc2l0aW9uICE9ICJpbnNpZGUiICYmIEUub3B0aW9ucy5wb3NpdGlvbiAhPSAiZnVsbHNjcmVlbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgYXkuYXBwZW5kKGwpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmZhZGVJbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgby5mYWRlVG8oMzAwLCBFLm9wdGlvbnMudGludE9wYWNpdHkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbC5mYWRlVG8oMzAwLCAxKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIFAuZmFkZVRvKDMwMCwgMSkNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG8uY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiBFLm9wdGlvbnMudGludE9wYWNpdHkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgbC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDENCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgUC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDENCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmZhZGVJbikgew0KICAgICAgICAgICAgICAgICAgICAgICAgUC5mYWRlVG8oMzAwLCAxKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgUC5jc3Moew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDENCiAgICAgICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy50aXRsZSAmJiBqICE9ICIiKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChFLm9wdGlvbnMuZmFkZUluKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0LmZhZGVUbygzMDAsIDEpDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0LmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBoID0gUS53aWR0aCgpOw0KICAgICAgICAgICAgICAgIGFoID0gUS5oZWlnaHQoKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmFkYXB0aXZlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChhZCA8IG0gfHwgYWsgPCBxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBrLndpZHRoKGFkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGsuaGVpZ2h0KGFrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGggPSBhZCAvIG0gKiBoOw0KICAgICAgICAgICAgICAgICAgICAgICAgYWggPSBhayAvIHEgKiBhaDsNCiAgICAgICAgICAgICAgICAgICAgICAgIFEud2lkdGgoaCk7DQogICAgICAgICAgICAgICAgICAgICAgICBRLmhlaWdodChhaCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzID0gYWcgPSBoOw0KICAgICAgICAgICAgICAgIHIgPSBhZSA9IGFoOw0KICAgICAgICAgICAgICAgIGFwID0gaCAvIGFoOw0KICAgICAgICAgICAgICAgIFcgPSBoIC8gYWE7DQogICAgICAgICAgICAgICAgVSA9IGFoIC8gYWo7DQogICAgICAgICAgICAgICAgdmFyIGFNLCBhTyA9IFsicGFkZGluZy0iLCAiYm9yZGVyLSJdOw0KICAgICAgICAgICAgICAgIG4gPSBPID0gMDsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciB2ID0gMDsgdiA8IGFPLmxlbmd0aDsgdisrKSB7DQogICAgICAgICAgICAgICAgICAgIGFNID0gcGFyc2VGbG9hdChsLmNzcyhhT1t2XSArICJ0b3Atd2lkdGgiKSk7DQogICAgICAgICAgICAgICAgICAgIG4gKz0gYU0gIT09IGFNID8gMCA6IGFNOw0KICAgICAgICAgICAgICAgICAgICBhTSA9IHBhcnNlRmxvYXQobC5jc3MoYU9bdl0gKyAiYm90dG9tLXdpZHRoIikpOw0KICAgICAgICAgICAgICAgICAgICBuICs9IGFNICE9PSBhTSA/IDAgOiBhTTsNCiAgICAgICAgICAgICAgICAgICAgYU0gPSBwYXJzZUZsb2F0KGwuY3NzKGFPW3ZdICsgImxlZnQtd2lkdGgiKSk7DQogICAgICAgICAgICAgICAgICAgIE8gKz0gYU0gIT09IGFNID8gMCA6IGFNOw0KICAgICAgICAgICAgICAgICAgICBhTSA9IHBhcnNlRmxvYXQobC5jc3MoYU9bdl0gKyAicmlnaHQtd2lkdGgiKSk7DQogICAgICAgICAgICAgICAgICAgIE8gKz0gYU0gIT09IGFNID8gMCA6IGFNDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG4gLz0gMjsNCiAgICAgICAgICAgICAgICBPIC89IDI7DQogICAgICAgICAgICAgICAgSCA9IGF0ID0gQiA9IFo7DQogICAgICAgICAgICAgICAgRyA9IGFyID0geiA9IFg7DQogICAgICAgICAgICAgICAgTChaLCBYKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnNtb290aCkgew0KICAgICAgICAgICAgICAgICAgICBhSyA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUoYykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgRS5ldmVudGNsaWNrKGF5KQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5tb3Zlem9vbSA9IGZ1bmN0aW9uICh2KSB7DQogICAgICAgICAgICBaID0gdi5wYWdlWDsNCiAgICAgICAgICAgIFggPSB2LnBhZ2VZOw0KICAgICAgICAgICAgaWYgKEQpIHsNCiAgICAgICAgICAgICAgICBZID0gWjsNCiAgICAgICAgICAgICAgICBWID0gWA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHUgPSBaIC0gYW07DQogICAgICAgICAgICB2YXIgYU0gPSBYIC0gYWk7DQogICAgICAgICAgICBpZiAoZCkgew0KICAgICAgICAgICAgICAgIHYucGFnZVggLT0gKHUgLSBhZCAvIDIpICogMjsNCiAgICAgICAgICAgICAgICB2LnBhZ2VZIC09IChhTSAtIGFrIC8gMikgKiAyDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodSA8IDAgfHwgdSA+IGFkIHx8IGFNIDwgMCB8fCBhTSA+IGFrKSB7DQogICAgICAgICAgICAgICAgYXkudHJpZ2dlcigibW91c2VsZWF2ZSIpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnNtb290aCkgew0KICAgICAgICAgICAgICAgIEIgPSB2LnBhZ2VYOw0KICAgICAgICAgICAgICAgIHogPSB2LnBhZ2VZDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHcoKTsNCiAgICAgICAgICAgICAgICBlKHYucGFnZVgsIHYucGFnZVkpOw0KICAgICAgICAgICAgICAgIGwuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgdG9wOiBhdSAtIG4sDQogICAgICAgICAgICAgICAgICAgIGxlZnQ6IGF3IC0gTw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGsuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgdG9wOiAtYXUsDQogICAgICAgICAgICAgICAgICAgIGxlZnQ6IC1hdw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIEModi5wYWdlWCwgdi5wYWdlWSwgMCwgMCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5ldmVudGRlZmF1bHQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBFLmV2ZW50b3BlbiA9IGZ1bmN0aW9uICh1KSB7DQogICAgICAgICAgICAgICAgdS54b24oIm1vdXNlZW50ZXIiLCBFLm9wZW56b29tKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIEUuZXZlbnRsZWF2ZSA9IGZ1bmN0aW9uICh1KSB7DQogICAgICAgICAgICAgICAgdS54b24oIm1vdXNlbGVhdmUiLCBFLmNsb3Nlem9vbSkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBFLmV2ZW50bW92ZSA9IGZ1bmN0aW9uICh1KSB7DQogICAgICAgICAgICAgICAgdS54b24oIm1vdXNlbW92ZSIsIEUubW92ZXpvb20pDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgRS5ldmVudHNjcm9sbCA9IGZ1bmN0aW9uICh1KSB7DQogICAgICAgICAgICAgICAgdS54b24oIm1vdXNld2hlZWwgRE9NTW91c2VTY3JvbGwiLCBFLnhzY3JvbGwpDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgRS5ldmVudGNsaWNrID0gZnVuY3Rpb24gKHUpIHsNCiAgICAgICAgICAgICAgICB1LnhvbigiY2xpY2siLCBmdW5jdGlvbiAodikgew0KICAgICAgICAgICAgICAgICAgICBheC50cmlnZ2VyKCJjbGljayIpDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5ldmVudHVuYmluZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGF4LnhvZmYoIm1vdXNlZW50ZXIiKTsNCiAgICAgICAgICAgIEUuZXZlbnRvcGVuID0gZnVuY3Rpb24gKHUpIHsgfTsNCiAgICAgICAgICAgIEUuZXZlbnRsZWF2ZSA9IGZ1bmN0aW9uICh1KSB7IH07DQogICAgICAgICAgICBFLmV2ZW50bW92ZSA9IGZ1bmN0aW9uICh1KSB7IH07DQogICAgICAgICAgICBFLmV2ZW50c2Nyb2xsID0gZnVuY3Rpb24gKHUpIHsgfTsNCiAgICAgICAgICAgIEUuZXZlbnRjbGljayA9IGZ1bmN0aW9uICh1KSB7IH0NCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5pbml0ID0gZnVuY3Rpb24gKHUpIHsNCiAgICAgICAgICAgIEUub3B0aW9ucyA9IGIuZXh0ZW5kKHt9LCBiLmZuLnh6b29tLmRlZmF1bHRzLCB1KTsNCiAgICAgICAgICAgIGlmIChFLm9wdGlvbnMucm9vdE91dHB1dCkgew0KICAgICAgICAgICAgICAgIE0gPSBiKCJib2R5IikNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgTSA9IGF4LnBhcmVudCgpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhbiA9IEUub3B0aW9ucy5wb3NpdGlvbjsNCiAgICAgICAgICAgIGQgPSBFLm9wdGlvbnMubGVuc1JldmVyc2UgJiYgRS5vcHRpb25zLnBvc2l0aW9uID09ICJpbnNpZGUiOw0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5zbW9vdGhab29tTW92ZSA8IDEpIHsNCiAgICAgICAgICAgICAgICBFLm9wdGlvbnMuc21vb3RoWm9vbU1vdmUgPSAxDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLnNtb290aExlbnNNb3ZlIDwgMSkgew0KICAgICAgICAgICAgICAgIEUub3B0aW9ucy5zbW9vdGhMZW5zTW92ZSA9IDENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChFLm9wdGlvbnMuc21vb3RoU2NhbGUgPCAxKSB7DQogICAgICAgICAgICAgICAgRS5vcHRpb25zLnNtb290aFNjYWxlID0gMQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5hZGFwdGl2ZSkgew0KICAgICAgICAgICAgICAgIGIod2luZG93KS54b24oImxvYWQiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIG0gPSBheC53aWR0aCgpOw0KICAgICAgICAgICAgICAgICAgICBxID0gYXguaGVpZ2h0KCk7DQogICAgICAgICAgICAgICAgICAgIEUuYWRhcHRpdmUoKTsNCiAgICAgICAgICAgICAgICAgICAgYih3aW5kb3cpLnJlc2l6ZShFLmFkYXB0aXZlKQ0KICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICB9DQogICAgICAgICAgICBFLmV2ZW50ZGVmYXVsdCgpOw0KICAgICAgICAgICAgRS5ldmVudG9wZW4oYXgpDQogICAgICAgIH07DQogICAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIEUuZXZlbnR1bmJpbmQoKQ0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLmNsb3Nlem9vbSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGFLID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLmZhZGVPdXQpIHsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLnRpdGxlICYmIGogIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgdC5mYWRlT3V0KDI5OSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKEUub3B0aW9ucy5wb3NpdGlvbiAhPSAiaW5zaWRlIiB8fCBFLm9wdGlvbnMucG9zaXRpb24gIT0gImZ1bGxzY3JlZW4iKSB7DQogICAgICAgICAgICAgICAgICAgIFAuZmFkZU91dCgyOTkpOw0KICAgICAgICAgICAgICAgICAgICBheS5mYWRlT3V0KDMwMCwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYUgoKQ0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGF5LmZhZGVPdXQoMzAwLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBhSCgpDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBhSCgpDQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIHRoaXMuZ2FsbGVyeSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBhTSA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgdmFyIHYsIHUgPSAwOw0KICAgICAgICAgICAgZm9yICh2ID0geTsgdiA8IEYubGVuZ3RoOyB2KyspIHsNCiAgICAgICAgICAgICAgICBhTVt1XSA9IEZbdl07DQogICAgICAgICAgICAgICAgdSsrDQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKHYgPSAwOyB2IDwgeTsgdisrKSB7DQogICAgICAgICAgICAgICAgYU1bdV0gPSBGW3ZdOw0KICAgICAgICAgICAgICAgIHUrKw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBpbmRleDogeSwNCiAgICAgICAgICAgICAgICBvZ2FsbGVyeTogRiwNCiAgICAgICAgICAgICAgICBjZ2FsbGVyeTogYU0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBmdW5jdGlvbiBhZih1KSB7DQogICAgICAgICAgICB2YXIgYU0gPSB1LmF0dHIoInRpdGxlIik7DQogICAgICAgICAgICB2YXIgdiA9IHUuYXR0cigieHRpdGxlIik7DQogICAgICAgICAgICBpZiAodikgew0KICAgICAgICAgICAgICAgIHJldHVybiB2DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChhTSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYU0NCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdGhpcy54YXBwZW5kID0gZnVuY3Rpb24gKHUpIHsNCiAgICAgICAgICAgIHZhciB2ID0gdS5wYXJlbnQoKTsNCiAgICAgICAgICAgIEZbYUNdID0gdi5hdHRyKCJocmVmIik7DQogICAgICAgICAgICB2LmRhdGEoInhpbmRleCIsIGFDKTsNCiAgICAgICAgICAgIGlmIChhQyA9PSAwICYmIEUub3B0aW9ucy5hY3RpdmVDbGFzcykgew0KICAgICAgICAgICAgICAgIEsgPSB1Ow0KICAgICAgICAgICAgICAgIEsuYWRkQ2xhc3MoRS5vcHRpb25zLmFjdGl2ZUNsYXNzKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGFDID09IDAgJiYgRS5vcHRpb25zLnRpdGxlKSB7DQogICAgICAgICAgICAgICAgaiA9IGFmKHUpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBhQysrOw0KDQogICAgICAgICAgICBmdW5jdGlvbiBhTShhTykgew0KICAgICAgICAgICAgICAgIGFIKCk7DQogICAgICAgICAgICAgICAgYU8ucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmFjdGl2ZUNsYXNzKSB7DQogICAgICAgICAgICAgICAgICAgIEsucmVtb3ZlQ2xhc3MoRS5vcHRpb25zLmFjdGl2ZUNsYXNzKTsNCiAgICAgICAgICAgICAgICAgICAgSyA9IHU7DQogICAgICAgICAgICAgICAgICAgIEsuYWRkQ2xhc3MoRS5vcHRpb25zLmFjdGl2ZUNsYXNzKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB5ID0gYih0aGlzKS5kYXRhKCJ4aW5kZXgiKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmZhZGVUcmFucykgew0KICAgICAgICAgICAgICAgICAgICBhYiA9IG5ldyBJbWFnZSgpOw0KICAgICAgICAgICAgICAgICAgICBhYi5zcmMgPSBheC5hdHRyKCJzcmMiKTsNCiAgICAgICAgICAgICAgICAgICAgUyA9IGIoYWIpOw0KICAgICAgICAgICAgICAgICAgICBTLmNzcyh7DQogICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogYXgub2Zmc2V0KCkudG9wLA0KICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogYXgub2Zmc2V0KCkubGVmdCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBheC53aWR0aCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBheC5oZWlnaHQoKQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgYihkb2N1bWVudC5ib2R5KS5hcHBlbmQoUyk7DQogICAgICAgICAgICAgICAgICAgIFMuZmFkZU91dCgyMDAsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFMucmVtb3ZlKCkNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIGFQID0gdi5hdHRyKCJocmVmIik7DQogICAgICAgICAgICAgICAgdmFyIGFOID0gdS5hdHRyKCJ4cHJldmlldyIpIHx8IHUuYXR0cigic3JjIik7DQogICAgICAgICAgICAgICAgaiA9IGFmKHUpOw0KICAgICAgICAgICAgICAgIGlmICh1LmF0dHIoInRpdGxlIikpIHsNCiAgICAgICAgICAgICAgICAgICAgYXguYXR0cigidGl0bGUiLCB1LmF0dHIoInRpdGxlIikpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGF4LmF0dHIoInhvcmlnaW5hbCIsIGFQKTsNCiAgICAgICAgICAgICAgICBheC5yZW1vdmVBdHRyKCJzdHlsZSIpOw0KICAgICAgICAgICAgICAgIGF4LmF0dHIoInNyYyIsIGFOKTsNCiAgICAgICAgICAgICAgICBpZiAoRS5vcHRpb25zLmFkYXB0aXZlKSB7DQogICAgICAgICAgICAgICAgICAgIG0gPSBheC53aWR0aCgpOw0KICAgICAgICAgICAgICAgICAgICBxID0gYXguaGVpZ2h0KCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoRS5vcHRpb25zLmhvdmVyKSB7DQogICAgICAgICAgICAgICAgdi54b24oIm1vdXNlZW50ZXIiLCB2LCBhTSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHYueG9uKCJjbGljayIsIHYsIGFNKQ0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLmluaXQoYUcpDQogICAgfQ0KICAgIGIuZm4ueHpvb20gPSBmdW5jdGlvbiAoZSkgew0KICAgICAgICB2YXIgYzsNCiAgICAgICAgdmFyIGQ7DQogICAgICAgIGlmICh0aGlzLnNlbGVjdG9yKSB7DQogICAgICAgICAgICB2YXIgZyA9IHRoaXMuc2VsZWN0b3Iuc3BsaXQoIiwiKTsNCiAgICAgICAgICAgIGZvciAodmFyIGYgaW4gZykgew0KICAgICAgICAgICAgICAgIGdbZl0gPSBiLnRyaW0oZ1tmXSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaCkgew0KICAgICAgICAgICAgICAgIGlmIChnLmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChoID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBiKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoYy5kYXRhKCJ4em9vbSIpKSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5kYXRhKCJ4em9vbSIpDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBjLnggPSBuZXcgYShjLCBlKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoYy54KSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYih0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjLngueGFwcGVuZChkKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGIodGhpcykuaXMoZ1swXSkgJiYgaCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjID0gYih0aGlzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKGMuZGF0YSgieHpvb20iKSkgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuZGF0YSgieHpvb20iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYy54ID0gbmV3IGEoYywgZSkNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKGMueCkgIT09ICJ1bmRlZmluZWQiICYmICFiKHRoaXMpLmlzKGdbMF0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGIodGhpcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYy54LnhhcHBlbmQoZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoaCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGMgPSBiKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIChjLmRhdGEoInh6b29tIikpICE9PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMuZGF0YSgieHpvb20iKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGMueCA9IG5ldyBhKGMsIGUpDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAoYy54KSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGQgPSBiKHRoaXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYy54LnhhcHBlbmQoZCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiAoYykgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgICBjLmRhdGEoInh6b29tIiwgYy54KTsNCiAgICAgICAgYihjKS50cmlnZ2VyKCJ4em9vbV9yZWFkeSIpOw0KICAgICAgICByZXR1cm4gYy54DQogICAgfTsNCiAgICBiLmZuLnh6b29tLmRlZmF1bHRzID0gew0KICAgICAgICBwb3NpdGlvbjogInJpZ2h0IiwNCiAgICAgICAgbXBvc2l0aW9uOiAiaW5zaWRlIiwNCiAgICAgICAgcm9vdE91dHB1dDogdHJ1ZSwNCiAgICAgICAgWG9mZnNldDogMCwNCiAgICAgICAgWW9mZnNldDogMCwNCiAgICAgICAgZmFkZUluOiB0cnVlLA0KICAgICAgICBmYWRlVHJhbnM6IHRydWUsDQogICAgICAgIGZhZGVPdXQ6IGZhbHNlLA0KICAgICAgICBzbW9vdGg6IHRydWUsDQogICAgICAgIHNtb290aFpvb21Nb3ZlOiAzLA0KICAgICAgICBzbW9vdGhMZW5zTW92ZTogMSwNCiAgICAgICAgc21vb3RoU2NhbGU6IDYsDQogICAgICAgIGRlZmF1bHRTY2FsZTogMCwNCiAgICAgICAgc2Nyb2xsOiB0cnVlLA0KICAgICAgICB0aW50OiBmYWxzZSwNCiAgICAgICAgdGludE9wYWNpdHk6IDAuNSwNCiAgICAgICAgbGVuczogZmFsc2UsDQogICAgICAgIGxlbnNPcGFjaXR5OiAwLjUsDQogICAgICAgIGxlbnNTaGFwZTogImJveCIsDQogICAgICAgIGxlbnNDb2xsaXNpb246IHRydWUsDQogICAgICAgIGxlbnNSZXZlcnNlOiBmYWxzZSwNCiAgICAgICAgb3Blbk9uU21hbGw6IHRydWUsDQogICAgICAgIHpvb21XaWR0aDogImF1dG8iLA0KICAgICAgICB6b29tSGVpZ2h0OiAiYXV0byIsDQogICAgICAgIHNvdXJjZUNsYXNzOiAieHpvb20tc291cmNlIiwNCiAgICAgICAgbG9hZGluZ0NsYXNzOiAieHpvb20tbG9hZGluZyIsDQogICAgICAgIGxlbnNDbGFzczogInh6b29tLWxlbnMiLA0KICAgICAgICB6b29tQ2xhc3M6ICJ4em9vbS1wcmV2aWV3IiwNCiAgICAgICAgYWN0aXZlQ2xhc3M6ICJ4YWN0aXZlIiwNCiAgICAgICAgaG92ZXI6IGZhbHNlLA0KICAgICAgICBhZGFwdGl2ZTogdHJ1ZSwNCiAgICAgICAgYWRhcHRpdmVSZXZlcnNlOiBmYWxzZSwNCiAgICAgICAgdGl0bGU6IGZhbHNlLA0KICAgICAgICB0aXRsZUNsYXNzOiAieHpvb20tY2FwdGlvbiIsDQogICAgICAgIGJnOiBmYWxzZQ0KICAgIH0NCn0pKGpRdWVyeSk7DQo=","CacheKey":"akVHJSIUKgQH-b_1M7D6lzQ-uNE"}